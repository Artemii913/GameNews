# ============================================
# GameNews ‚Äî –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–∫–∞—Å—Ç–æ–≤
# –ó–∞–ø—É—Å–∫: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 06:00 UTC (09:00 MSK)
# 
# –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
# 1. –°–æ–±–∏—Ä–∞–µ—Ç –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ –∏–≥—Ä–æ–≤—ã—Ö RSS-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
# 2. –û–∑–≤—É—á–∏–≤–∞–µ—Ç —á–µ—Ä–µ–∑ gTTS
# 3. –ü—É–±–ª–∏–∫—É–µ—Ç –Ω–∞ GitHub Pages
# ============================================

name: Daily GameNews Podcast

on:
  schedule:
    # 06:00 UTC = 09:00 MSK
    - cron: '0 6 * * *'
  
  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)
  workflow_dispatch:

# –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ GitHub Pages
permissions:
  contents: write
  pages: write

jobs:
  generate-podcasts:
    runs-on: ubuntu-latest
    
    steps:
      # 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      - name: üì• Checkout repository
        uses: actions/checkout@v4

      # 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python
      - name: üêç Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      - name: üì¶ Install dependencies
        run: |
          pip install --upgrade pip
          pip install feedparser gTTS

      # 4. –°–æ–±–∏—Ä–∞–µ–º –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ RSS
      - name: üì° Parse RSS feeds
        run: |
          echo "=== –°–±–æ—Ä –∏–≥—Ä–æ–≤—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π ==="
          python scripts/rss_parser.py

      # 5. –û–∑–≤—É—á–∏–≤–∞–µ–º –ø–æ–¥–∫–∞—Å—Ç—ã
      - name: üéôÔ∏è Generate audio (TTS)
        run: |
          echo "=== –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ ==="
          python scripts/generate_podcast.py

      # 6. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      - name: ‚úÖ Check results
        run: |
          echo "=== –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ ==="
          echo "podcasts.json:"
          cat podcasts.json | python -m json.tool | head -30
          echo ""
          echo "–ê—É–¥–∏–æ—Ñ–∞–π–ª—ã:"
          ls -la audio/ 2>/dev/null || echo "–ü–∞–ø–∫–∞ audio/ –ø—É—Å—Ç–∞"
          echo ""
          echo "–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:"
          ls -la texts/ 2>/dev/null || echo "–ü–∞–ø–∫–∞ texts/ –ø—É—Å—Ç–∞"

      # 7. –ü—É–±–ª–∏–∫—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
      - name: üöÄ Commit and push
        run: |
          git config user.name "GameNews Bot"
          git config user.email "bot@gamenews.local"
          git add -A
          git diff --staged --quiet || git commit -m "üéÆ –ü–æ–¥–∫–∞—Å—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã: $(date +'%d.%m.%Y %H:%M')"
          git push
